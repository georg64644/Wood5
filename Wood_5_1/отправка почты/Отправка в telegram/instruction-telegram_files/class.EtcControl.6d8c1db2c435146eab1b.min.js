(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{1779:function(t,s,a){"use strict";a.r(s),a.d(s,"Link",(function(){return u})),a.d(s,"Toggle",(function(){return g})),a.d(s,"Button",(function(){return v})),a.d(s,"AjaxToggle",(function(){return y})),a.d(s,"AjaxButton",(function(){return E})),a.d(s,"default",(function(){return b}));var i=a(11),e=a.n(i),r=a(131),n=a(86),c=a(45),m=a.n(c),o=a(57),h=a(3),l=a(0),p=a(10);class u{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={})}get popoverData(){return{label:this.params.label,icon:this.params.icon,analyticsEvent:this.params.analyticsEvent,url:this.params.href||this.params.getHref(this.mainElement)}}destroy(){this.mainElement=null,this.params=null}}var d=a(4);class g{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={}),this.setState(this.getState())}get popoverData(){return{label:this.params.labels[this.currentState],icon:this.icon,analyticsEvent:this.analyticsEvent,action:async t=>{await this.makeAction(),t.label=this.params.labels[this.currentState],t.icon=this.icon,t.analyticsEvent=this.analyticsEvent}}}get analyticsEvent(){return Array.isArray(this.params.analyticsEvent)?this.params.analyticsEvent[this.currentState]:this.params.analyticsEvent}get icon(){return Array.isArray(this.params.icon)?this.params.icon[this.currentState]:this.params.icon}getState(){return"1"===Object(l.data)(this.mainElement,this.params.name+"-state")?1:0}setState(t){this.currentState=t,Object(l.data)(this.mainElement,this.params.name+"-state",this.currentState)}makeAction(){return new Promise((t,s)=>{(void 0===this.params.msg.confirm||confirm(this.params.msg.confirm[this.currentState]))&&this.params.action(this.mainElement,this.currentState,s=>{!1!==s&&void 0!==this.params.msg.success?Object(d.vueNotify)({type:"success",message:this.params.msg.success[this.currentState]}):!1===s&&void 0!==this.params.msg.error&&Object(d.vueNotify)({type:"error",message:this.params.msg.success[this.currentState]}),!1!==s&&(this.setState(1-this.currentState),t()),void 0!==this.params.callback&&this.params.callback()})})}destroy(){this.dom=null,this.params=null}}class v{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={})}get popoverData(){return{label:this.params.label,icon:this.params.icon,analyticsEvent:this.params.analyticsEvent,action:()=>{if("function"==typeof this.params.getClickData){const t=this.params.getClickData(this.mainElement),s=v.parseAirClickAttribute(t);window.triggerDomEvent.call(this,s.name,s.params)}else this.makeAction()}}}makeAction(){(void 0===this.params.msg.confirm||confirm(this.params.msg.confirm))&&this.params.action(this.mainElement,t=>{!1!==t&&void 0!==this.params.msg.success?Object(d.vueNotify)({type:"success",message:this.params.msg.success}):!1===t&&void 0!==this.params.msg.error&&Object(d.vueNotify)({type:"error",message:this.params.msg.error}),void 0!==this.params.callback&&this.params.callback(t)})}destroy(){this.mainElement=null,this.params=null}static parseAirClickAttribute(t){const s=t.match(/[^?]*/)[0],a=t.match(/[^?]*$/)[0];return{name:s,params:a?a.split("&").reduce((t,s)=>{const a=s.split("=");return t[a[0]]=a[1],t},{}):{}}}}class y{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={}),this.setState(this.getState())}get popoverData(){return{label:this.params.labels[this.currentState],disabled:!1,icon:this.icon,analyticsEvent:this.analyticsEvent,action:async t=>{t.disabled=!0,await this.sendAjax(),t.disabled=!1,t.label=this.params.labels[this.currentState],t.icon=this.icon,t.analyticsEvent=this.analyticsEvent}}}get analyticsEvent(){return Array.isArray(this.params.analyticsEvent)?this.params.analyticsEvent[this.currentState]:this.params.analyticsEvent}get icon(){return Array.isArray(this.params.icon)?this.params.icon[this.currentState]:this.params.icon}getState(){return"1"===Object(l.data)(this.mainElement,this.params.name+"-state")?1:0}setState(t){this.currentState=t,Object(l.data)(this.mainElement,this.params.name+"-state",this.currentState)}sendAjax(){return new Promise((t,s)=>{(void 0===this.params.msg.confirm||confirm(this.params.msg.confirm[this.currentState]))&&h.c({url:void 0!==this.params.urls?this.params.urls[this.currentState]:this.params.url,data:void 0!==this.params.getData?this.params.getData(this.mainElement,this.currentState):{},complete:(s,a)=>{!0!==a&&void 0!==this.params.msg.success?Object(d.vueNotify)({type:"success",message:this.params.msg.success[this.currentState]}):!0===a&&void 0!==this.params.msg.error&&Object(d.vueNotify)({type:"error",message:this.params.msg.error[this.currentState]}),!0!==a&&(this.setState(1-this.currentState),t()),void 0!==this.params.callback&&this.params.callback(s,a)}})})}destroy(){this.mainElement=null,this.params=null}}class E{constructor(t,s){this.mainElement=t,this.params=s,void 0===this.params.msg&&(this.params.msg={})}get popoverData(){return{label:this.params.label,disabled:!1,icon:this.icon,analyticsEvent:this.params.analyticsEvent,action:async t=>{t.disabled=!0,await this.sendAjax(),t.disabled=!1,t.icon=this.icon}}}get icon(){return Array.isArray(this.params.icon)?this.params.icon[this.currentState]:this.params.icon}sendAjax(){return new Promise((t,s)=>{if(void 0!==this.params.msg.confirm&&!confirm(this.params.msg.confirm))return t();h.c({url:void 0!==this.params.getUrl?this.params.getUrl(this.mainElement):this.params.url,data:void 0!==this.params.getData?this.params.getData(this.mainElement):{},complete:(s,a)=>{!0!==a&&void 0!==this.params.msg.success?Object(d.vueNotify)({type:"success",message:this.params.msg.success}):!0===a&&void 0!==this.params.msg.error&&Object(d.vueNotify)({type:"error",message:this.params.msg.error}),void 0!==this.params.callback&&this.params.callback(s,a),t()}})})}destroy(){this.mainElement=null,this.params=null}}class b{constructor(t){this.element=t.element,this.controllingModule=t.controlling_module,this.clickHandler=this.onElementClick.bind(this),this.isOpened=!1,this.isLoading=!1,this.config=this.element.dataset,this.permissions={},this.items=[],this.element.addEventListener("click",this.clickHandler),this.init()}init(){this.extendVue(),this.app=new e.a,this.app.$popover.on("close",()=>{this.isOpened=!1});const t=window.Air&&window.Air.get("module.hawk");t&&t.connectVue(e.a)}extendVue(){e.a.directive("click-outside",n.a),e.a.use(m.a,{translations:o,defaultLanguage:window.__i18nLocale}),e.a.use(r.a)}onElementClick(t){const s=Object(l.data)(this.element,"analytics-event-name");s&&p.sendDefaultEvent(s),t.preventDefault(),t.stopPropagation(),this.isOpened?this.close():this.open()}async open(){this.isOpened||this.isLoading||(this.isLoading=!0,this.items.length||(this.permissions=await b.getPermissions(this.config.permissions),Object.entries(this.permissions).forEach(([t,s])=>{if(!s)return;const a=this.controllingModule.getControl(this.element,t);a&&a.popoverData&&this.items.push({...a.popoverData,action:t=>{"function"==typeof a.popoverData.action&&a.popoverData.action(t),this.app.$popover.close()}})})),this.isLoading=!1,this.items.length&&(this.isOpened=!0,this.app.$popover.open({items:this.items,target:this.element,position:this.config.position,align:this.config.align})))}close(){this.isOpened=!1,this.app.$popover.close()}destroy(){this.close(),this.element.removeEventListener("click",this.clickHandler),this.clickHandler=null,this.config={},this.permissions={},this.app.$popover&&this.app.$popover.off("close"),this.app&&(this.app.$destroy(),this.app=null)}static getPermissions(t){return Object(h.e)({type:"get",url:"/etc/permissions",data:{token:t}})}}}}]);