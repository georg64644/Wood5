(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{1012:function(t,e,s){var i=s(1268);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,s(29).default)("15eb9951",i,!1,{})},1267:function(t,e,s){"use strict";s(1012)},1268:function(t,e,s){(e=s(28)(!1)).push([t.i,":root {\n/**\n   * Raw height of the Mobile App bar (without safe-area-inset)\n   */\n  --mobile-bar-height-raw: 50px;\n/**\n   * Height of the Mobile App Bar\n   */\n  --mobile-bar-height: calc(var(--mobile-bar-height-raw) + env(safe-area-inset-bottom));\n/**\n   * Height of the App Redirect block for anon users\n   */\n  --mobile-app-redirect-height: 56px;\n}\n.v-repost {\n  position: relative;\n}\n.v-repost:hover .v-repost__button,\n.v-repost--active .v-repost__button {\n  color: #4683d9;\n}\n.v-repost:hover:after,\n.v-repost--active:after {\n  content: '';\n  position: absolute;\n  width: 100%;\n  height: 20px;\n}\n.v-repost--loading {\n  pointer-events: none;\n  opacity: 0.5;\n}\n.v-repost .icon {\n  display: block;\n}\n.v-repost .popover {\n  margin-top: 8px;\n  top: 100%;\n  left: 50%;\n  -webkit-transform: translateX(-50%);\n  transform: translateX(-50%);\n  z-index: 10;\n  max-width: 210px;\n}\n.v-repost .popover--subsites {\n  width: 200px !important;\n}\n.v-repost .popover-item__slot {\n  width: 16px;\n  color: #346eb8;\n}\n.v-repost__button {\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n  align-items: center;\n  color: #595959;\n  cursor: pointer;\n}\n.v-repost__counter {\n  font-weight: 500;\n  margin-left: 4px;\n}\n",""]),t.exports=e},237:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:t.onClickOutside,expression:"onClickOutside"}],class:["v-repost",{"v-repost--active":t.isReposted,"v-repost--loading":t.isLoadingSubsites}],on:{mouseenter:function(e){return t.setButtonHover(!0)},mouseleave:function(e){return t.setButtonHover(!1)}}},[s("div",{staticClass:"v-repost__button",attrs:{title:"Сделать репост"},on:{click:t.onRepostButtonClick}},[s("icon",{attrs:{name:"v_repost",width:22,height:22}}),t._v(" "),t.counter?s("div",{staticClass:"v-repost__counter"},[t._v("\n      "+t._s(t.counter)+"\n    ")]):t._e()],1),t._v(" "),t.isPopoverActive&&t.isReposting?s("popover",{key:"popover-subsites",staticClass:"popover--subsites",attrs:{title:"Поделиться сейчас","is-search-enabled":!0,"search-url":"/reposts/getsubsites","search-query-handler":t.onBeforeServerSearch,"pre-selected":t.repostedSubsitesIdsList,disabled:t.repostingSubsitesIdsList,"is-selectable":!1,"is-multiple":!0},on:{select:t.onSubsiteSelect,search:t.onSubsitesSearch},model:{value:t.availableSubsitesList,callback:function(e){t.availableSubsitesList=e},expression:"availableSubsitesList"}}):t._e(),t._v(" "),s("keep-alive",[!t.isPopoverActive&&t.isButtonHovered&&t.counter>0?s("popover",{key:"popover-reposted",attrs:{"is-selectable":!1,"initial-data-url":"/reposts/getreposted?content_id="+t.contentId+"&format=popover"},model:{value:t.repostedSubsitesList,callback:function(e){t.repostedSubsitesList=e},expression:"repostedSubsitesList"}}):t._e()],1)],1)};i._withStripped=!0;var o=s(11),n=s.n(o),r=s(88),a=s(30),l=s(560),p=s(85),u=s(3),c=s(10);n.a.use(r.a,{observer:!0});var d={name:"layout-repost",components:{Icon:a.a,Popover:p.default},props:{contentId:{type:Number,default:0},count:{type:Number,default:0},isReposted:{type:Boolean,default:!1},gtm:{type:String,default:""}},data(){return{moduleWriting:null,moduleAuthData:null,isButtonHovered:!1,isLoadingSubsites:!1,isPopoverActive:!1,isReposting:!1,repostedSubsitesList:[],availableSubsitesList:[],repostedSubsitesIdsList:[],repostingSubsitesIdsList:[],counter:this.count}},watch:{availableSubsitesList(t){this.highlightRepostedItems(t)},repostedSubsitesList(t){this.repostedSubsitesIdsList=t.map(t=>t.value)},isReposting(t){!1===t&&this.availableSubsitesList.sort((t,e)=>e.isReposted-t.isReposted)}},created(){this.moduleWriting=Air.import("module.writing"),this.moduleAuthData=Air.import("module.auth_data")},methods:{setButtonHover(t){window.matchMedia("(hover: none)").matches||(this.isButtonHovered=t)},highlightRepostedItems(t){t.forEach(t=>{t.isReposted&&this.$set(t,"slot",{component:a.a,props:{name:"v_tick",width:16,height:16}})})},async onRepostButtonClick(){if(!this.isLoadingSubsites){if(this.isPopoverActive)return this.isPopoverActive=!1,void(this.isReposting=!1);Object(c.sendDefaultEvent)(this.gtm),this.isLoadingSubsites=!0;try{this.availableSubsitesList.length||(this.availableSubsitesList=await this.getSubsitesForRepost());const t=this.moduleAuthData.getId(),e=this.availableSubsitesList[0];if(1===this.availableSubsitesList.length&&e.value===t)return void this.onSubsiteSelect(e.value,e);this.isPopoverActive=!0,this.isReposting=!0}catch(t){console.error("Error while fetching subsites for repost",t)}finally{this.isLoadingSubsites=!1}}},getSubsitesForRepost(){return Object(u.e)({type:"GET",url:"/reposts/getsubsites",data:{contentId:this.contentId}})},onClickOutside(){this.isPopoverActive&&(this.isPopoverActive=!1,this.isReposting=!1)},onBeforeServerSearch(t){const e=t.startsWith("http"),s=parseInt(e?t.replace(/\D+/,""):t,10),i={contentId:this.contentId};return Number.isNaN(s)?i.query=t:i.id=s,i},onSubsitesSearch(t){this.highlightRepostedItems(t)},async onSubsiteSelect(t,e){const s=e.isReposted,i=s?"/reposts/remove":"/reposts/create",o={contentId:this.contentId,subsiteId:e.value};if(!this.repostingSubsitesIdsList.includes(e.value)){this.repostingSubsitesIdsList.push(e.value),this.$set(e,"slot",{component:l.a,props:{size:"small"}});try{const t=await Object(u.e)({type:"POST",url:i,data:o});this.$set(e,"slot",null),s?(this.repostedSubsitesIdsList.splice(this.repostedSubsitesIdsList.indexOf(e.value),1),this.repostedSubsitesList=this.repostedSubsitesList.filter(t=>this.repostedSubsitesIdsList.includes(t.value)),this.counter-=1):(this.repostedSubsitesIdsList.push(e.value),this.repostedSubsitesList.push(Object.assign({},e)),this.counter+=1),e.isReposted=!s;const n=e.isReposted?{component:a.a,props:{name:"v_tick",width:16,height:16}}:null;this.$set(e,"slot",n),this.isReposted=t.mine_count>0,this.notifyAfterRepost(e,!s)}catch(t){console.error("Repost error",t),this.$set(e,"slot",null)}finally{this.repostingSubsitesIdsList.splice(this.repostingSubsitesIdsList.indexOf(e.value),1)}}},notifyAfterRepost(t,e){console.log(t);const s=t.value===this.moduleAuthData.getId(),i=this.$gettext(e?"Post has been published in":"Post has been unpublished from"),o=s?this.$pgettext(e?"nominative":"genitive","your blog"):`«${t.label}»`;this.$notify({type:"success",message:`${i} ${o}`})}}},h=(s(1267),s(14)),v=Object(h.a)(d,i,[],!1,null,null,null);v.options.__file="src/Components/Content/vue/repost/chunk.layout-repost.vue";e.default=v.exports},560:function(t,e,s){"use strict";var i=function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["v-loader","ui_preloader","ui_preloader--"+this.size,{"ui_preloader--white":"light"===this.mode}]},[e("span",{staticClass:"ui_preloader__dot"}),this._v(" "),e("span",{staticClass:"ui_preloader__dot"}),this._v(" "),e("span",{staticClass:"ui_preloader__dot"})])};i._withStripped=!0;var o={name:"layout-loader",components:{},props:{mode:{type:String,default:"dark"},size:{type:String,default:"default"}},computed:{}},n=s(14),r=Object(n.a)(o,i,[],!1,null,null,null);r.options.__file="src/Components/Ui/vue/layout/layout-loader.vue";e.a=r.exports}}]);